<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Prime Unicorn</title>


      <script src="/__/firebase/7.14.2/firebase-app.js"></script>
      <script src="/__/firebase/7.14.2/firebase-analytics.js"></script>
      <script src="/__/firebase/init.js"></script>
      <script src="/__/firebase/7.14.2/firebase-database.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

    <style media="screen">
        body {
            max-width: 360px;
            margin: auto;
            background:slategray;
        }
        .center-title {
            text-align: center;
            color: whitesmoke;
            font-family: sans-serif;
        }
        table {
            width: 360px;
            height: 360px;
            clear: both;
            table-layout: fixed;
        }
        table, th, td {
          border: 1px solid whitesmoke;
          border-collapse: collapse;
        }
        td {
            width: 65px;
            font-family: sans-serif;
            color: whitesmoke;
            height: 65px;
            font-size: 50px;
            text-align: center;
        }
        #purple {
            transform: scaleX(-1); 
            filter: invert(71%) sepia(44%) saturate(672%) hue-rotate(214deg) brightness(89%) contrast(91%);
        }
        .left {
            float: left;
        }
        #green {
            filter: invert(94%) sepia(11%) saturate(1649%) hue-rotate(28deg) brightness(99%) contrast(98%);
            float: right;
        }
        #purplescore {
            width: 125px;
            float: left;
            text-align: center;
            color: #c395da;
        }
        #greenscore {
            width: 125px;
            float: right;
            text-align: center;
            color: #c4f57f;
        }
        #scores {
            clear: both;
        }
    </style>
  </head>
  <body>
    <h1 class="center-title">
            Prime Unicorn
        </h1>
        <img height="125px" src="https://static.thenounproject.com/png/1112380-200.png" id="purple" class="left">
        <img height="125px" src="https://static.thenounproject.com/png/1112380-200.png" id="green">
    <div id="scores">
        <h2 id="purplescore">0</h2>
        <h2 id="greenscore">0</h2>
    </div>
    <table>
        <tr>
            <td id="0"></td>
            <td id="1"></td>
            <td id="2"></td>
            <td id="3"></td>
            <td id="4"></td>
        </tr>
        <tr>
            <td id="5"></td>
            <td id="6"></td>
            <td id="7"></td>
            <td id="8"></td>
            <td id="9"></td>
        </tr>
        <tr>
            <td id="10"></td>
            <td id="11"></td>
            <td id="12"></td>
            <td id="13"></td>
            <td id="14"></td>
        </tr>
        <tr>
            <td id="15"></td>
            <td id="16"></td>
            <td id="17"></td>
            <td id="18"></td>
            <td id="19"></td>
        </tr>
        <tr>
            <td id="20"></td>
            <td id="21"></td>
            <td id="22"></td>
            <td id="23"></td>
            <td id="24"></td>
        </tr>
    </table>
    <script>

$(function () {

function isPrime(n) {
    if (!Number.isInteger(n) || n < 2) {
        return false;
    }
    for (let i = 2; i <= n / 2; i++) {
        if (n % i === 0) {
            return false;
        }
    }
    return true;
}

    var username = 'Amin';
    var localdata = {
        state: 0,
        level: 0,
        players: {
            'Amin': 0,
            'Maura': 0,
        },
        board: [],
    };

    function generateBoard() {
        var maxNum = 2 + localdata.level * 0.5;
        for (let i = 0; i < 25; i++) {
            localdata.board[i] = Math.floor(Math.random() * maxNum) + 1;
        }
    }

    function isRoundOver() {
        for (let i = 0; i < 25; i++) {
            if (isPrime(localdata.board[i])) {
                return false;
            }
        }
        return true;
    }

    function bindBoard() {
        $('td').each(function() {
            var index = parseInt($(this).attr('id'));
            if (localdata.board[index] == 'Amin') {
                $(this).html('<img height="50px" src="https://static.thenounproject.com/png/1112380-200.png" id="purple">');
            } else {
                $(this).text(localdata.board[index]);
            }
        });
    }
    function bindScores() {
        $('#purplescore').text(localdata.players['Amin']);
        $('#greenscore').text(localdata.players['Maura']);
    }

    generateBoard();
    bindBoard();
    $('td').each(function() {
        $(this).click(function() {
            var index = $(this).attr('id');
            if (Number.isInteger(localdata.board[index])) {
                if (isPrime(localdata.board[index])) {
                    localdata.players[username] += 1;
                    localdata.board[index] = 'Amin';
                } else {
                    alert(localdata.board[index] + ' is not prime!')
                    localdata.board[index] = '';
                }
            }
            if (isRoundOver()) {
                localdata.level += 1;
                generateBoard();
            }
            bindBoard();
            bindScores();
        });
    })

    var hash = window.location.hash.substring(1);
    if (!hash) {
        hash = 'unicorn';
    }
/*    firebase.database().ref('/' + hash).on('value', serverdata => {

    });*/

});



/* state
 0 = name entry
 1 = ready to start round X? | wait for player to join
 2 = waiting for Y to start
 3 = starting round X in 3, 2, 1..
 4 = gameplay -> 1
*/
    </script>
  </body>
</html>
